---
import Modal from './Modal.jsx';
---

<html lang="pt-BR">
  <head>
    <script type="module">
      document.addEventListener('DOMContentLoaded', () => {
        const btn = document.querySelector('#openModalBtn');
        const modal = document.querySelector('#modal');
        const closeBtn = document.querySelector('#closeModalBtn');
        const form = document.querySelector('#propertyForm');

        btn?.addEventListener('click', () => {
          modal.style.display = 'flex';
        });

        closeBtn?.addEventListener('click', () => {
          modal.style.display = 'none';
        });

        form?.addEventListener('submit', async (e) => {
          e.preventDefault();

          const formData = new FormData(form);
          const data = Object.fromEntries(formData.entries());

          try {
            const response = await fetch('/api/properties', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(data),
            });

            if (!response.ok) {
              throw new Error('Erro ao cadastrar o imóvel');
            }

            alert('Imóvel cadastrado com sucesso!');
            modal.style.display = 'none';
            form.reset();
          } catch (error) {
            alert(error.message);
          }
        });
      });
    </script>
  </head>
  <body>
    <header class="bg-white shadow p-4 flex justify-between items-center">
      <h2 class="text-xl font-bold">Bem-vindo à sua Carteira de Imóveis</h2>
      <button
        id="openModalBtn"
        class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-500"
        aria-label="Nova Transação"
        title="Nova Transação"
        data-tooltip="Nova Transação"
      >
        Nova Transação
      </button>
    </header>

    <div
      id="modal"
      class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center"
    >
      <div class="bg-white p-6 rounded shadow-lg w-1/3">
        <h3 class="text-lg font-bold mb-4">Cadastrar Novo Imóvel</h3>
        <form id="propertyForm">
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">Nome do Imóvel</label>
            <input
              type="text"
              name="name"
              class="w-full border border-gray-300 rounded px-3 py-2"
              placeholder="Digite o nome do imóvel"
              required
            />
          </div>
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">Localização</label>
            <input
              type="text"
              name="location"
              class="w-full border border-gray-300 rounded px-3 py-2"
              placeholder="Digite a localização"
              required
            />
          </div>
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">Avaliação</label>
            <input
              type="number"
              name="valuation"
              class="w-full border border-gray-300 rounded px-3 py-2"
              placeholder="Digite a avaliação"
              required
            />
          </div>
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">Forma de Pagamento</label>
            <input
              type="text"
              name="payment_method"
              class="w-full border border-gray-300 rounded px-3 py-2"
              placeholder="Digite a forma de pagamento"
              required
            />
          </div>
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">Data de Aquisição</label>
            <input
              type="date"
              name="acquisition_date"
              class="w-full border border-gray-300 rounded px-3 py-2"
              required
            />
          </div>
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">Finalidade</label>
            <input
              type="text"
              name="purpose"
              class="w-full border border-gray-300 rounded px-3 py-2"
              placeholder="Digite a finalidade"
              required
            />
          </div>
          <div class="flex justify-end">
            <button
              type="button"
              id="closeModalBtn"
              class="bg-gray-300 text-black px-4 py-2 rounded mr-2"
            >
              Cancelar
            </button>
            <button
              type="submit"
              class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-500"
            >
              Salvar
            </button>
          </div>
        </form>
      </div>
    </div>
  </body>
</html>