---
import BaseLayout from '../layouts/BaseLayout.astro';
import FinancialChart from '../components/FinancialChart.astro';
import LoanOverview from '../components/LoanOverview.astro';
import { supabase } from '../utils/supabaseClient';

const { data: { session } } = await supabase.auth.getSession();

if (!session) {
  console.log("User not authenticated");
  // throw new Error('redirect:/sign-in');
}

const properties = [
  {
    id: 1,
    name: 'Apartamento no Centro',
    location: 'São Paulo, SP',
    valuation: 'R$ 500.000',
    acquisition_date: '2023-05-10',
    purpose: 'Investimento',
  },
  {
    id: 2,
    name: 'Casa na Praia',
    location: 'Florianópolis, SC',
    valuation: 'R$ 750.000',
    acquisition_date: '2022-11-15',
    purpose: 'Lazer',
  },
  {
    id: 3,
    name: 'Terreno Comercial',
    location: 'Curitiba, PR',
    valuation: 'R$ 1.200.000',
    acquisition_date: '2021-08-20',
    purpose: 'Comercial',
  },
];
---

<BaseLayout>
  <h2 class="text-xl font-semibold mb-4">Visão Geral</h2>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <FinancialChart />
    <LoanOverview />
  </div>

  <h2 class="text-xl font-semibold mt-8 mb-4">Imóveis Cadastrados</h2>
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    {properties.map((property) => (
      <div key={property.id} class="bg-white shadow rounded p-4">
        <h3 class="text-lg font-bold mb-2">{property.name}</h3>
        <p class="text-sm text-gray-600">Localização: {property.location}</p>
        <p class="text-sm text-gray-600">Avaliação: {property.valuation}</p>
        <p class="text-sm text-gray-600">Data de Aquisição: {property.acquisition_date}</p>
        <p class="text-sm text-gray-600">Finalidade: {property.purpose}</p>
      </div>
    ))}
  </div>
</BaseLayout>
